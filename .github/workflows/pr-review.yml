name: Custom PR Reviewer

on:
  pull_request:

jobs:
  review:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Extract PR info
      run: |
        echo "PR_TITLE=${{ github.event.pull_request.title }}" >> $GITHUB_ENV
        echo "BRANCH=${{ github.head_ref }}" >> $GITHUB_ENV
        echo "COMMIT_MSG=$(git log -1 --pretty=%B)" >> $GITHUB_ENV

    - name: Metadata Validation
      run: |
        ./scripts/pr-review.sh "$PR_TITLE" "$BRANCH" "$COMMIT_MSG"

    - name: Install dependencies
      run: npm ci

    - name: Lint
      run: npm run lint

    - name: Tests + Coverage
      run: npm test -- --coverage

    - name: Dependency Scan
      run: npm audit --audit-level=high
